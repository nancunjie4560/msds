---
title: "Project 2 in R"
subtitle: "DATA 624-01 Group 3"
author: "Z. Palmore, K. Popkin, K. Potter, C. Nan, J. Ramalingam"
date: "7/8/2021"
output: 
  word_document:
    toc: true
    highlight: tango
header-includes: 
- \newcommand{\bcenter}{\begin{center}}
- \newcommand{\ecenter}{\end{center}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=F)
```

# Summary



# Data Exploration

Data is loaded and all packages used throughout the report are noted. We view a random sample of the data below. It shows the randomly selected observations as the first, second, third, fourth, and fifth for each variable. 

```{r, eval=T, warning=F, message=F}
library(utils)
library(psych)
library(tidyverse)
library(corrplot)
library(MASS)
library(caret)
library(flextable)
ph <- read.csv(
  "https://raw.githubusercontent.com/palmorezm/msds/main/624/Projects/Project2/StudentData%20-%20TO%20MODEL.csv")
obs.sample <- as.data.frame(t(head(sample_n(ph[1:33], 5), 5)))
obs.sample <- obs.sample %>% 
  mutate(Variable = colnames(ph)) %>%
  dplyr::select(Variable, 1, 2, 3, 4, 5)
flextable(obs.sample) %>% 
  theme_vanilla() %>% 
  set_table_properties(layout = "autofit")
```



We note a few interesting facts before exploring further. We notice that data is missing. These appear as empty spots on the table. It also appears due to the conversion of spreadsheet formats from excel to csv when hosting the data, our first column variable name is legible but needs the "i.." symbol removed. None of the other 33 variables need to be renamed. Our target variable, PH, appears to be on a scale between 1 and 10, as it should be, while the others vary between roughly -100 (Mnf.Flow) and greater than 4000 (Filler.Speed). We take a closer look at these variables with some descriptive statistics.   



```{r, eval=T}
ph.desc <- ph %>% 
  describe() %>%
  round(digits = 1) %>% 
  mutate('missing' = round(((2571 - n)/2571)*100, 2), 
         obs = n) %>%
  dplyr::select(obs, missing, median, mean, 
                sd, min, max, range, skew, se)
flextable::flextable(ph.desc) %>% 
  theme_vanilla() %>% 
  set_table_properties(layout = "autofit")
```



```{r}
plot(ph$PH)
numerics <- ph %>% 
  dplyr::select(is.numeric) 
res <- cor(numerics, use = "complete.obs")
round(res, 2)
corrplot::corrplot(res, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)
numerics[is.na(numerics)] <- median(numerics, na.rm=TRUE)
ph %>% 
  select(PH, Oxygen.Filler) %>% 
  mutate(ValueIndex = 1:length(ph$PH)) %>% 
  ggplot() + 
  geom_point(aes(ValueIndex, PH, color = Oxygen.Filler))
ggplot(ph, aes(PH)) + geom_histogram() 
ggplot(ph, aes(PH, PH)) + geom_violin() 
```




```{r}
ggplot() + geom_boxplot(aes(ph$PH))
```

# Data Preparation

```{r}
# replaces NA with median (given a removal of missing values in calculation)
for (i in colnames(ph)) {
  ph[[i]][is.na(ph[[i]])] <- median(ph[[i]], na.rm=TRUE)
}
sum(is.na(ph))
```



```{r}
# select numeric variables
ph.numerics <- ph %>% 
  dplyr::select(is.numeric)
# remove outliers based on IQR
for (i in colnames(ph.numerics)) {
  iqr <- IQR(ph.numerics[[i]])
  q <- quantile(ph.numerics[[i]], probs = c(0.25, 0.75), na.rm = FALSE)
  qupper <- q[2]+1.5*iqr
  qlower <- q[1]+1.5*iqr
  outlier_free <- subset(ph.numerics, ph.numerics[[i]] > (q[1] - 1.5*iqr) & ph.numerics[[i]] < (q[2]+1.5*iqr) )
}
ph.numerics <- outlier_free
# join outlier free numerics with categorical 
Brand.Code <- ph$Ã¯..Brand.Code
df <- cbind(Brand.Code, ph.numerics)
sum(is.na(df$Brand.Code))
```


# Model Building


```{r}
model.pm <- lm(PH~.,df)
pm <- stepAIC(model.pm, trace = F, direction = "both")
p <- summary(pm)$call
pm <- lm(p[2], df)
summary(pm)
```



```{r}
model.ks <- lm(PH~., df)
summary(model.ks)
```




```{r}
data <- df %>% 
  dplyr::select(Brand.Code, 
                Carb.Volume,
                Fill.Ounces,
                PC.Volume,
                Carb.Temp,
                PSC, 
                PSC.Fill, 
                PSC.CO2,
                PH,
                Mnf.Flow, 
                Carb.Pressure1, 
                Fill.Pressure, 
                Hyd.Pressure2, 
                Hyd.Pressure3, 
                Filler.Level,
                Temperature, 
                Usage.cont,
                Carb.Flow,
                Density,
                Balling,
                Pressure.Vacuum, 
                Oxygen.Filler, 
                Bowl.Setpoint, 
                Pressure.Setpoint, 
                Alch.Rel,
                Balling.Lvl)
```


```{r}
# Split 70-30 training test
set.seed(1102)
index <- createDataPartition(data$PH, p = .7, 
                             list = FALSE, times = 1)
train <- data[index,]
test <- data[-index,]
```


# Model Selection


# Predictions


# Conclusion













































































